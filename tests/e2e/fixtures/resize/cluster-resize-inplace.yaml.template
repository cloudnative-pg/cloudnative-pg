apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: postgresql-resize-inplace
spec:
  instances: 3

  postgresql:
    parameters:
      max_connections: "110"
      log_checkpoints: "on"

  # Resource requirements for initial setup
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "1000m"

  # In-place resize policy configuration
  resourceResizePolicy:
    strategy: InPlace
    cpu:
      restartPolicy: NotRequired
      maxIncreasePct: 200
      maxDecreasePct: 50
    memory:
      restartPolicy: NotRequired
      maxIncreasePct: 100
      maxDecreasePct: 50

  bootstrap:
    initdb:
      database: app
      owner: app

  # Persistent storage configuration
  storage:
    storageClass: ${E2E_DEFAULT_STORAGE_CLASS}
    size: 1Gi
  walStorage:
    storageClass: ${E2E_DEFAULT_STORAGE_CLASS}
    size: 1Gi
