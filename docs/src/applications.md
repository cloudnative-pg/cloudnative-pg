# Connecting from an application

Applications work with the services created by CloudNativePG
in the same Kubernetes cluster:

* `[cluster name]-rw`
* `[cluster name]-ro`
* `[cluster name]-r`

Those services are entirely managed by the Kubernetes cluster and
implement a form of virtual IP as described in the
[Service page of the Kubernetes documentation](https://kubernetes.io/docs/concepts/services-networking/service/#virtual-ips-and-service-proxies).

!!! Hint
    We highly recommend using those services in your applications.
    Avoid connecting directly to a specific PostgreSQL instance, which
    can change during the cluster lifetime.

You can use these services in your applications through:

* DNS resolution
* Environment variables

For the credentials to connect to PostgreSQL, you can
use the secrets generated by the operator.

!!! Seealso "Connection pooling"
    See [Connection pooling](connection_pooling.md) for
    information about how to take advantage of PgBouncer as a connection pooler
    and create an access layer between your applications and the PostgreSQL clusters.

### DNS resolution

You can use the Kubernetes DNS service to point to a given server.
The Kubernetes DNS service is required by the operator.
If the application is deployed in the same namespace as the PostgreSQL cluster,
you can do that by using the name of the service.
IF the PostgreSQL cluster resides in a different namespace, you can use the
full qualifier: `<service-name>.<namespace-name>`.

DNS is the preferred and recommended discovery method.

### Environment variables

If you deploy your application in the same namespace that contains the
PostgreSQL cluster, you can also use environment variables to connect to the database.

For example, suppose that your PostgreSQL cluster is called `pg-database`.
You can use the following environment variables in your applications:

* `PG_DATABASE_R_SERVICE_HOST` — The IP address of the service
  pointing to all the PostgreSQL instances for read-only workloads.

* `PG_DATABASE_RO_SERVICE_HOST` — The IP address of the
  service pointing to all hot-standby replicas of the cluster.

* `PG_DATABASE_RW_SERVICE_HOST` — the IP address of the
  service pointing to the *primary* instance of the cluster.

### Secrets

The PostgreSQL operator generates up to two `basic-auth` type secrets for every
PostgreSQL cluster it deploys:

* `[cluster name]-app` (unless you have provided an existing secret through `.spec.bootstrap.initdb.secret.name`)
* `[cluster name]-superuser` (if `.spec.enableSuperuserAccess` is set to `true`
  and you have not specified a different secret using `.spec.superuserSecret`)

Each secret contains the following:

* Username
* Password
* Hostname to the RW service
* Port number
* Database name
* A working [`.pgpass file`](https://www.postgresql.org/docs/current/libpq-pgpass.html)
* [uri](https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING)
* [jdbc-uri](https://jdbc.postgresql.org/documentation/use/#connecting-to-the-database)

The `-app` credentials are the ones for applications
connecting to the PostgreSQL cluster to use. They correspond to the user who owns the
database.

The `-superuser` credentials are only for administrative purposes
and correspond to the postgres user. Since version 1.21, superuser access
over the network is disabled by default.
