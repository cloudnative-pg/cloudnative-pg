# Release notes for CloudNativePG 1.26
<!-- SPDX-License-Identifier: CC-BY-4.0 -->

History of user-visible changes in the 1.26 minor release of CloudNativePG.

For a complete list of changes, please refer to the
[commits](https://github.com/cloudnative-pg/cloudnative-pg/commits/release-1.26
on the release branch in GitHub.

## Version 1.26.0-rc1

**Release date:** Mar 28, 2025

### Important Changes:

- **Deprecation of Native Barman Cloud Support**: Native backup and recovery
  support for Barman Cloud is now deprecated and will be fully removed in
  version 1.28.0. Users should begin planning the migration of their existing
  clusters to the new [Barman Cloud Plugin](https://github.com/cloudnative-pg/plugin-barman-cloud)
  to ensure a smooth transition. (#6876)

- **Hibernation Command Changes**: The `hibernate on/off` commands in the
  `cnpg` plugin for `kubectl` now act as shortcuts for the declarative
  hibernation procedure. The previous imperative implementation has been removed
  in favor of the declarative approach. Additionally, the `hibernate status`
  command has been **removed**, as its functionality is now covered by the
  standard `status` command. **Warning:** Do not upgrade to version 1.26 of both
  the plugin and the operator unless you are prepared to migrate to the
  declarative method. (#7155)

- Dropped support for Barman versions 3.4 and earlier, including capability
  detection framework. Users running very old operand versions (from before
  April 2023) must update the operand before upgrading the operator. (#7220)

### Features:

- **Declarative Offline In-Place Major Upgrades of PostgreSQL**: Introduced
  support for offline in-place major upgrades when a new operand container
  image with a higher PostgreSQL major version is applied to a cluster. During
  the upgrade, all cluster pods are shut down to ensure data consistency. A new
  job is created to validate upgrade conditions, run `pg_upgrade`, and set up new
  directories for `PGDATA`, WAL files, and tablespaces as needed. Once the
  upgrade is complete, replicas are re-created. Failed upgrades can be rolled
  back declaratively. (#6664)

- **Improved Startup and Readiness Probes for Replicas**: Enhanced support for
  Kubernetes startup and readiness probes in PostgreSQL instances, providing
  greater control over replicas based on the streaming lag. (#6623)

- **Declarative management of extensions and schemas**: Introduced the
  `extensions` and `schemas` stanzas in the Database resource to declaratively
  create, modify, and drop PostgreSQL extensions and schemas within a database. (#7062)

### Enhancements:

- Implemented the `cnpg.io/validation` annotation, allowing users to disable
  the validation webhook on CloudNativePG-managed resources. Use with caution,
  as this can permit unrestricted changes. (#7196)

- Introduced the `STANDBY_TCP_USER_TIMEOUT` operator configuration setting,
  which, if specified, sets the `tcp_user_timeout` parameter on all standby
  instances managed by the operator. (#7036) <!-- no 1.25 1.24 1.22 -->

- Added the `KUBERNETES_CLUSTER_DOMAIN` configuration option to the operator,
  allowing users to specify the domain suffix for fully qualified domain names
  (FQDNs) generated within the Kubernetes cluster. If not set, it defaults to
  `cluster.local`. (#6989) <!-- no 1.22 -->

- Introduce the `DRAIN_TAINTS` operator configuration option to customize which
  node taints indicate a node is being drained, replacing the fixed behavior of
  treating only `node.kubernetes.io/unschedulable` as a drain signal.

- Added support for patching PostgreSQL instance pods using the
  `cnpg.io/podPatch` annotation with a JSON Patch. Use with caution, as this may
  introduce discrepancies between the operatorâ€™s expectations and Kubernetes
  behavior. (#6323) <!-- no 1.25 1.24 1.22 -->

- Add support for collecting `pg_stat_wal` metrics in PostgreSQL 18. (#7005)

- Add support for LZ4, XZ, and Zstandard compression methods when archiving
  WAL files. (#7151)

- The `pg_extensions` metric has been added, providing information about
  the installed extensions and their latest available versions. (#7195) <!-- no 1.25 1.24 1.22 -->

- `cnpg` plugin updates:
    - ...

- CloudNativePG Interface (CNPG-I):
    - A plugin can now trigger instance rollouts by implementing the `EVALUATE`
      verb. This ensures that plugin-induced changes are properly reconciled.
      (#7126) <!-- no 1.24 1.22 -->

### Security:

- Add ...
- Improve ...

### Fixes:

- Automatic reload the TLS certificates of the CNPG-i plugins when they change. (#7029) <!-- no 1.22 -->

- Prevent a race condition causing the operator to perform two switchovers when updating
  the PostgreSQL configuration. (#6991)

- The generated PodMonitors now have an appropriate matchLabels scope for the targeted
  pooler and cluster pods. Previously, the matchLabels were too broad and wrongly inherited
  labels from the cluster, leading to data collection from unwanted targets. (#7063)

- A webhook warning is now issued if a cluster is applied with a shared_buffers
  value missing a unit (e.g., MB, GB). This will become an error in future
  releases. Users should update configurations to include explicit units
  (e.g., use 512MB instead of 512). (#7160)

- Treat timeout errors during volume snapshot creation as retryable to prevent
  unnecessary backup failures. (#7010) <!-- no 1.24 1.22 -->

- `cnpg` plugin:
  - Ensures the primary Pod is recreated during an imperative restart when
    primaryUpdateMethod is set to restart, aligning its definition with the replicas. (#7122)

- `CNPG-I`:

  - The operator now properly closes the plugin connection when performing a backup
    using the plugin. (#7095, #7096) <!-- no 1.22 -->

  - Fix a bug that prevented WALs from being archived on a former primary node
    when using a plugin. (#6964) <!-- no 1.25 1.24 1.22 -->

<!--
- Enhance ...
- Disable ...
- Gracefully handle ...
- Wait ...
- Fix ...
- Address ...
- `cnpg` plugin:
    - ...
    - ...
-->

### Supported versions

- Kubernetes 1.32, 1.31, and 1.30
- PostgreSQL 17, 16, 15, 14, and 13
    - PostgreSQL 17.X is the default image
    - PostgreSQL 13 support ends on November 12, 2025
