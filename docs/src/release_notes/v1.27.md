# Release notes for CloudNativePG 1.27

History of user-visible changes in the 1.27 minor release of CloudNativePG.

For a complete list of changes, please refer to the
[commits](https://github.com/cloudnative-pg/cloudnative-pg/commits/release-1.27)
on the release branch in GitHub.

<!-- TODO: add to 1.27.1 when the fix is available
### Enhancements:

- Enabled simultaneous image and configuration changes, allowing you to update
  the container image (including PostgreSQL version or extensions) and
  PostgreSQL configuration settings in the same operation. The operator first
  applies the image change, followed by the configuration changes in a subsequent
  rollout, ensuring safe and consistent cluster updates
  ([#8115](https://github.com/cloudnative-pg/cloudnative-pg/pull/8115)).
-->

## Version 1.27.1

**Release date:** Oct 23, 2025

### Changes

<!-- NO: 1.25 -->
- Delayed the decommissioning of native in-core support for Barman Cloud to at
  least version 1.29.
  ([#8670](https://github.com/cloudnative-pg/cloudnative-pg/pull/8670))

- Adopted the new format of `postgres-containers` and `postgis-containers`
  images and image catalog artifacts, and **updated** the default PostgreSQL
  version to `18.0-system-trixie` (PostgreSQL 18 is now supported).
  ([#8578](https://github.com/cloudnative-pg/cloudnative-pg/pull/8578),
  [#8760](https://github.com/cloudnative-pg/cloudnative-pg/pull/8760),
  [#8558](https://github.com/cloudnative-pg/cloudnative-pg/pull/8558))

- Deprecated the `monitoring.enablePodMonitor` field in the `Cluster` and
  `Pooler` resources. This field will be removed in a future release. Users who
  rely on `PodMonitor` resources should create them manually instead.
  ([#8753](https://github.com/cloudnative-pg/cloudnative-pg/pull/8753))

### Enhancements

- Added support for overriding the PgBouncer `auth_type`, `server_tls_sslmode`,
  and `client_tls_sslmode` settings, which were previously hardcoded. Default
  values remain consistent with the former behavior but can now be customized
  when required.
  ([#8674](https://github.com/cloudnative-pg/cloudnative-pg/pull/8674))

- Added a `CHECKPOINT` step before PostgreSQL smart and fast shutdowns to
  reduce shutdown duration and replica promotion time, especially on systems
  with a high `checkpoint_timeout`.
  ([#8867](https://github.com/cloudnative-pg/cloudnative-pg/pull/8867))

- Added a warning in the instance manager for deprecated or unsupported OS
  versions, based on the official `postgres-containers` project.
  ([#8601](https://github.com/cloudnative-pg/cloudnative-pg/pull/8601))

- Improved certificate parsing error reporting. Failures now log specific
  errors instead of a generic message, aiding troubleshooting. This is
  particularly relevant after the CVE-2025-58187 fix in Go 1.25.2 and 1.24.8,
  which may trigger parsing failures for invalid DNS SANs.
  ([#8801](https://github.com/cloudnative-pg/cloudnative-pg/pull/8801))

- Added a check to ensure the destination WAL archive path is empty when
  bootstrapping a cluster using the `pg_basebackup` method, consistent with
  other bootstrap methods.
  ([#8895](https://github.com/cloudnative-pg/cloudnative-pg/pull/8895))

- Added validation to prevent backups from running on hibernated clusters.
  Backups attempted on such clusters now fail with reason
  `ClusterIsHibernated`, following the standard prerequisite check pattern.
  ([#8870](https://github.com/cloudnative-pg/cloudnative-pg/pull/8870))

- Added support for `pprof` profiling. Instances can now enable the `pprof`
  tool by adding the `alpha.cnpg.io/enableInstancePprof` annotation to the
  `Cluster` resource for advanced debugging.
  ([#7876](https://github.com/cloudnative-pg/cloudnative-pg/pull/7876))

- `cnpg` plugin:

   - Updated the Flexible I/O Tester (FIO) image to
     `wallnerryan/fiotools-aio:v2`, as provided by Ryan Wallner.
     ([#8847](https://github.com/cloudnative-pg/cloudnative-pg/pull/8847))

   - Enhanced the `cnpg status backup` command to provide more detailed status
     information when using a `barman-cloud`-based backup plugin.
     ([#8780](https://github.com/cloudnative-pg/cloudnative-pg/pull/8780),
     [#8690](https://github.com/cloudnative-pg/cloudnative-pg/pull/8690))

### Fixes

- Fixed backup restoration failures when using custom WAL segment sizes with
  parallel WAL recovery. The operator no longer manages the end-of-WAL file
  marker during restoration, preventing errors when backups span multiple WAL
  segments.
  ([#8873](https://github.com/cloudnative-pg/cloudnative-pg/pull/8873))

- Fixed a bug in major upgrades where a volume snapshot from a previous minor
  version could be incorrectly used to optimize replica creation.
  ([#8475](https://github.com/cloudnative-pg/cloudnative-pg/pull/8475))

- Fixed `initdb` to wait for the application user secret before bootstrapping
  a new cluster, preventing potential race conditions.
  ([#8663](https://github.com/cloudnative-pg/cloudnative-pg/pull/8663))

<!-- NO: 1.25 --><!-- NO: 1.26 -->
- Fixed quorum-based failover to work correctly in clusters with only two
  instances using synchronous replication.
  ([#8680](https://github.com/cloudnative-pg/cloudnative-pg/pull/8680))

<!-- NO: 1.25 --><!-- NO: 1.26 -->
- Fixed configuration hash calculation to ignore internal configuration fields,
  preventing unnecessary reconciliations.
  ([#8868](https://github.com/cloudnative-pg/cloudnative-pg/pull/8868))

- Fixed the connection retry logic in the `cnpgi` plugin. The reconciliation
  loop now detects connection pool changes correctly and uses exponential
  backoff to reduce "closed pool" errors.
  ([#8554](https://github.com/cloudnative-pg/cloudnative-pg/pull/8554))

- Fixed volume snapshot usage during replica scaling to work with backup plugins.
  Previously, this optimization was only available with the in-tree backup
  implementation, but now clusters using backup plugins can also leverage volume
  snapshots when creating new replicas.
  ([#8506](https://github.com/cloudnative-pg/cloudnative-pg/pull/8506))

- Fixed the `Pooler` templating to correctly inherit settings for the
  bootstrap controller init container.
  ([#8394](https://github.com/cloudnative-pg/cloudnative-pg/pull/8394))

- Fixed webhook errors to use the correct API group (`postgresql.cnpg.io`) in
  `Pooler` and backup webhooks, ensuring consistent API error reporting.
  ([#8485](https://github.com/cloudnative-pg/cloudnative-pg/pull/8485))

- Fixed a potential nil pointer dereference in the hibernation reconciler when
  handling errors. Contributed by @PascalBourdier.
  ([#8756](https://github.com/cloudnative-pg/cloudnative-pg/pull/8756))

- Fixed an issue in the environment cache where callers could inadvertently
  modify shared data. The `LoadEnv` function now returns a copy of cached
  environment slices to prevent mutations from affecting the cache.
  ([#8880](https://github.com/cloudnative-pg/cloudnative-pg/pull/8880))

## Version 1.27.0

**Release date:** Aug 12, 2025

### Important changes

- The default behavior of the [liveness probe](../instance_manager.md#liveness-probe) has been updated.
  An [isolated primary is now forcibly shut down](../instance_manager.md#primary-isolation)
  within the configured `livenessProbeTimeout` (default: 30 seconds).

### Features

- **Dynamic loading of PostgreSQL extensions**: Introduced the
  `.spec.postgresql.extensions` stanza for mounting PostgreSQL extensions,
  packaged as OCI-compliant container images, as read-only and immutable volumes
  inside instance pods. This allows dynamic extension management without
  rebuilding base images.
  ([#7991](https://github.com/cloudnative-pg/cloudnative-pg/pull/7991)).

- **Logical decoding slot synchronization in HA clusters**: Added the
  `synchronizeLogicalDecoding` field under
  `spec.replicationSlots.highAvailability` to enable automatic synchronization of
  logical decoding slots across high-availability clusters, ensuring logical
  replication subscribers continue seamlessly after a publisher failover
  ([#7931](https://github.com/cloudnative-pg/cloudnative-pg/pull/7931)).

- **Primary Isolation Check**: Promoted to stable the liveness pinger
  experimental feature introduced in 1.26, adding the
  `.spec.probes.liveness.isolationCheck` section to enable primary isolation
  checks in the liveness probe by default. This improves the detection and
  handling of primary connectivity issues in Kubernetes environments
  ([#7845](https://github.com/cloudnative-pg/cloudnative-pg/pull/7845)).

### Enhancements

- Introduced an opt-in experimental feature that enables quorum-based failover
  to improve safety and data durability during failover events. This feature,
  also called failover quorum, can be activated via the
  `alpha.cnpg.io/failoverQuorum` annotation.
  ([#7572](https://github.com/cloudnative-pg/cloudnative-pg/pull/7572)).

- Added support for user maps for predefined users such as `streaming_replica`,
  allowing the use of self-managed client certificates with different Common
  Names in environments with strict policies or shared CAs, while still enabling
  replicas to join clusters using the `streaming_replica` role
  ([#7725](https://github.com/cloudnative-pg/cloudnative-pg/pull/7725)).

- Added a new `PhaseFailurePlugin` phase in the `Cluster` status to improve
  observability of plugin-related failures
  ([#7988](https://github.com/cloudnative-pg/cloudnative-pg/pull/7988)).

- Made the `Backup.spec` field immutable after creation, ensuring consistency
  and predictability in backup operations
  ([#7904](https://github.com/cloudnative-pg/cloudnative-pg/pull/7904)).

- Added `fqdn-uri` and `fqdn-jdbc-uri` fields in the user secret to simplify
  the retrieval of fully qualified domain name-based connection strings
  ([#7852](https://github.com/cloudnative-pg/cloudnative-pg/pull/7852)).

- CNPG-I:

    - Added `Postgres` interface support to the CNPG-I operator, continuing the
      transition toward a plugin-based architecture
      ([#7179](https://github.com/cloudnative-pg/cloudnative-pg/pull/7179)).

    - Added `metrics` capabilities to the CNPG-I instance webserver, enabling
      metrics exposure directly from the instance for better observability
      ([#8033](https://github.com/cloudnative-pg/cloudnative-pg/pull/8033)).

### Fixes

- Unblocked rollouts when migrating to the `barman-cloud` plugin using the
  `switchover` strategy. Former primary Pods now restart correctly after WAL
  archiving fails due to missing plugin support.
  ([#8236](https://github.com/cloudnative-pg/cloudnative-pg/pull/8236))

### Supported versions

- Kubernetes 1.33, 1.32, and 1.31
- PostgreSQL 17, 16, 15, 14, and 13
    - PostgreSQL 17.5 is the default image
    - PostgreSQL 13 support ends on November 12, 2025
